<!--
 * @Author: hanxiumin
 * @Date: 2020-06-30 14:35:32
 * @LastEditTime: 2020-07-15 15:27:37
 * @LastEditors: 李淳
 * @Description: In User Settings Edit
 * @FilePath: /cosmos/docs/cosmos/i18.md
--> 
# 国际化

> cosmos统一框架配置 国际化

## 国际化概述
国际化是一个看似简单，实则非常复杂的领域，实际进行国际化工作时，大家会发现大体会涉及到以免内容：
- 前端国际化
- 服务端国际化
- 国际化资源文件管理
- 模块之间、开发者与翻译者之间的协作

## 基于React-Intl的前端国际化简述
### 接入步骤
1、在项目根组件外层引入国际化上下文组件(LanguageProvider) 具体实现参考 src/containers/LanguageProvider/index.tsx
```javascript
<LanguageProvider messages={messages}>
  <ConnectedRouter history={history}>
    <App />
  </ConnectedRouter>
</LanguageProvider>
```
2.在组件中使用React-Intl's Components
```javascript
 import React from 'react';
 import { FormattedMessage } from 'react-intl';
 import messages from './messages';
 
 export default function NotFoundPage() {
   return (
     <h2>
       <FormattedMessage {...messages.notFoundText} />
     </h2>
   );
 }
```
3、在组件中使用React-Intl's Api
```javascript
import React from 'react';
import { InjectedIntlProps, injectIntl } from 'react-intl';
import messages from './messages';

function NotFoundPage(props: InjectedIntlProps) {
  const { intl } = props;
  return (
    <h2>
      { intl.formatMessage(messages.notFoundText)}
    </h2>
  );
}
export default injectIntl(NotFoundPage);
```
4、

### 国际化配置
- 在src/configs/base.conf.js 中i18nConf下进行配饰
- enable 系统是否开启国际化
- defaultLocale 系统默认显示语言
- locales 系统支持的语言类型
- cookieName 存储国际化字段的cookie名称

### 国际化资源管理
1、目录结构
```
-src
  --translations
  ---- en-US.json 对应语言的json key-value 格式
  ---- zh-CN.json
-src
  --pages
  ----- pageContainer 具体的模块名称
  -------- messages.tsx
  -------- constants.tsx // 模块messages存储位置
  --utils
  ------ constants.ts
  ------ messages.ts // 公共message存储位置
```
2、可以运行 npm run extract-intl 生成json,此json可以提供PM或者翻译团队进行翻译，中文会使用defaultMessage更新文件、除了中文外的如果有了翻译的值有默认原有的值，如果有新增则使用兜底中文进行生成，若messages里有重名的key择自动化生成json会失败，并提醒重复key的文件位置，方便进行修复。
3、在同一结构下的messages和constants文件引用，不要出现跨目录的静态变量引用

### 国际化性能问题及优化
1、当项目达到一定程度时，需要国际化的文案会随之增多，系统加载json的体积会变大、随之带来性能问题、页面loading时间长
2、在引入时将平铺json转化为嵌套格式的json，在使用的时候在转换为平铺。

更多详细内容请参考官方完档 https://formatjs.io/docs/react-intl/

